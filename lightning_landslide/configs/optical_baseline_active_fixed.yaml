# =============================================================================
# ä¿®å¤ç‰ˆï¼šoptical_baseline_active_fixed.yaml - äººå·¥æŒ‡å¯¼ä¸»åŠ¨å­¦ä¹ é…ç½®
# =============================================================================

# ä¿®å¤å†…å®¹ï¼š
# 1. ç¡®ä¿åŸºç¡€è®­ç»ƒé…ç½®ä¸optical_baseline.yamlå®Œå…¨ä¸€è‡´
# 2. ä¿®å¤traineré…ç½®ï¼Œç¡®ä¿epochæ•°å’Œå…¶ä»–å‚æ•°æ­£ç¡®
# 3. å®Œå–„ä¸»åŠ¨å­¦ä¹ é…ç½®å’Œäººå·¥æ ‡æ³¨æµç¨‹

# å®éªŒä¿¡æ¯
experiment_name: "human_guided_active_learning_v2"
description: "Human-guided active learning with real expert annotations"
version: "1.0.0"
tags: ["optical", "active_learning", "human_guided"]

# ç ”ç©¶äººå‘˜ä¿¡æ¯
author: "MM-LandslideNet Team"
created_date: "2024-07-30"
notes: |
  åŸºäºoptical_baseline.yamlçš„äººå·¥æŒ‡å¯¼ä¸»åŠ¨å­¦ä¹ å®éªŒ
  é¢„æœŸé€šè¿‡ä¸»åŠ¨å­¦ä¹ ç­–ç•¥ä»F1 0.85æå‡åˆ°0.88+

# å…¨å±€è®¾ç½® - ä¸baselineä¿æŒä¸€è‡´
seed: 3407
log_level: "INFO"

# æ¨¡å‹é…ç½® - ä¸optical_baseline.yamlå®Œå…¨ä¸€è‡´
model:
  target: lightning_landslide.src.models.LandslideClassificationModule
  params:
    base_model:
      target: lightning_landslide.src.models.optical_swin.OpticalSwinModel
      params:
        model_name: "swinv2_tiny_window16_256"
        input_channels: 5
        pretrained: true
        dropout_rate: 0.2
        pretrained_path: null
        img_size: 256
    
    classifier_config:
      type: "simple"
      hidden_dim: null
      use_batch_norm: false
      activation: "relu"
    
    loss_config:
      type: "focal"
      focal_params: {alpha: 0.25, gamma: 2.0}
    
    optimizer_config:
      type: "adamw"
      adamw_params: {lr: 4e-5, weight_decay: 1e-2, betas: [0.9, 0.95]}
      differential_lr: {enable: true, backbone_lr_ratio: 0.1, classifier_lr_ratio: 1.0}
    
    scheduler_config:
      type: "cosine_with_warmup"
      cosine_params:
        T_0: 20
        T_mult: 1
        eta_min: 1e-7
    
    metrics_config:
      primary_metric: "f1"
      metrics: ["accuracy", "precision", "recall", "f1", "auroc"]
      threshold: 0.5

# æ•°æ®é…ç½® - ä¸optical_baseline.yamlä¿æŒä¸€è‡´
data:
  target: lightning_landslide.src.data.MultiModalDataModule
  params:
    # æ•°æ®è·¯å¾„
    train_data_dir: "dataset/train_data"
    test_data_dir: "dataset/test_data"
    train_csv: "dataset/Train.csv"
    test_csv: "dataset/Test.csv"
    exclude_ids_file: "dataset/data_check/exclude_ids.json"

    # é€šé“é…ç½® - ä¸baselineä¸€è‡´
    channel_config:
      channel_groups:
        optical: [0, 1, 2, 3]
        sar_amplitude: [4, 5, 8, 9]
        sar_difference: [6, 7, 10, 11]
        derived: ["ndvi"]
      usage_modes:
        optical_only:
          groups: ["optical", "derived"]
          description: "ä»…ä½¿ç”¨å…‰å­¦æ•°æ®ï¼Œé€‚åˆåŸºçº¿å®éªŒ"
    
    active_mode: "optical_only"
    
    # æ•°æ®åŠ è½½é…ç½® - ä¸baselineä¿æŒä¸€è‡´
    batch_size: 32
    num_workers: 0
    pin_memory: false
    
    # æ•°æ®åˆ†å‰² - ä¸baselineä¿æŒä¸€è‡´
    val_split: 0.2
    stratify: true
    shuffle_train: true

    # é¢„å¤„ç†é…ç½® - ä¸baselineä¿æŒä¸€è‡´
    preprocessing:
      normalization:
        means: [1849.282, 1953.906, 1896.493, 3291.47, -9.624, -17.110, 
                -0.699, -0.483, -10.671, -18.442, 0.248, -0.234]
        stds: [1414.462, 1338.292, 1342.528, 1448.362, 7.904, 9.245, 
              4.062, 4.283, 6.333, 8.691, 2.777, 3.932]
      ndvi_computation:
        red_channel_idx: 0
        nir_channel_idx: 3
        epsilon: 1e-8
        clip_range: [-1, 1]

    # æ•°æ®å¢å¼ºé…ç½® - ä¸baselineä¿æŒä¸€è‡´
    augmentation:
      train:
        resize: 256
        geometric:
          random_flip: true
          h_flip_prob: 0.5
          v_flip_prob: 0.5
          random_rotation: true
          rotation_prob: 0.3
          rotation_degrees: [-10, 10]
        spectral:
          spectral_noise: true
          noise_std: 0.005
          noise_prob: 0.3
          ndvi_preserving: true
          preserve_prob: 0.7
      val: {resize: 256}
      test: {resize: 256}

# === äººå·¥æŒ‡å¯¼ä¸»åŠ¨å­¦ä¹ é…ç½® ===
active_pseudo_learning:
  max_iterations: 5                     # ä¸»åŠ¨å­¦ä¹ è¿­ä»£æ¬¡æ•°
  annotation_budget: 20                 # æ¯è½®äººå·¥æ ‡æ³¨æ ·æœ¬æ•°
  
  # æ ‡æ³¨æ¨¡å¼é…ç½®
  annotation_mode: "human"              # "human" | "simulated"
  annotation_timeout: 1800              # æ ‡æ³¨è¶…æ—¶æ—¶é—´ (30åˆ†é’Ÿ)
  
  # ä¸ç¡®å®šæ€§ä¼°è®¡é…ç½®
  uncertainty_estimation:
    method: "mc_dropout"
    params:
      n_forward_passes: 3              # MC Dropoutå‰å‘ä¼ æ’­æ¬¡æ•°
      use_temperature_scaling: false    # æ˜¯å¦ä½¿ç”¨æ¸©åº¦ç¼©æ”¾
  
  # ä¼ªæ ‡ç­¾ç”Ÿæˆé…ç½®
  pseudo_labeling:
    confidence_threshold: 0.85          # ä¼ªæ ‡ç­¾ç½®ä¿¡åº¦é˜ˆå€¼
    uncertainty_threshold: 0.1          # ä¸ç¡®å®šæ€§é˜ˆå€¼
    use_adaptive_threshold: false       # æ˜¯å¦ä½¿ç”¨è‡ªé€‚åº”é˜ˆå€¼
    use_class_balance: true             # æ˜¯å¦è€ƒè™‘ç±»åˆ«å¹³è¡¡
  
  # ä¸»åŠ¨å­¦ä¹ é€‰æ‹©ç­–ç•¥
  active_learning:
    budget_per_iteration: 20            # æ¯è½®æ ‡æ³¨é¢„ç®—
    strategies:
      uncertainty: 0.6                  # ä¸ç¡®å®šæ€§æƒé‡
      diversity: 0.3                    # å¤šæ ·æ€§æƒé‡
      cluster_based: 0.1                # èšç±»æƒé‡
  
  # äººå·¥æ ‡æ³¨è´¨é‡æ§åˆ¶
  annotation_quality:
    min_confidence: 0.7                 # æœ€ä½æ¥å—çš„æ ‡æ³¨ç½®ä¿¡åº¦
    require_confidence: false           # æ˜¯å¦è¦æ±‚ä¸“å®¶æä¾›ç½®ä¿¡åº¦
    save_annotation_history: true      # ä¿å­˜æ ‡æ³¨å†å²

# === è®­ç»ƒå™¨é…ç½® ===
# âš ï¸ é‡è¦ä¿®å¤ï¼šåŸºç¡€è®­ç»ƒä½¿ç”¨ä¸baselineä¸€è‡´çš„é…ç½®
trainer:
  target: pytorch_lightning.Trainer
  params:
    # ğŸ”§ ä¿®å¤ï¼šåŸºç¡€è®­ç»ƒä½¿ç”¨100 epochsï¼Œä¸baselineä¸€è‡´
    max_epochs: 100                 # åŸºç¡€è®­ç»ƒepochæ•°ï¼ˆä¸baselineä¸€è‡´ï¼‰
    accelerator: "gpu"
    devices: 1
    precision: "32-true"            # ä¸baselineä¸€è‡´ï¼Œé¿å…ç²¾åº¦é—®é¢˜
    
    # éªŒè¯é…ç½® - ä¸baselineä¿æŒä¸€è‡´
    val_check_interval: 1.0
    check_val_every_n_epoch: 1
    
    # æ¢¯åº¦é…ç½® - ä¸baselineä¿æŒä¸€è‡´
    gradient_clip_val: 1.0
    accumulate_grad_batches: 1
    
    # è¿›åº¦å’Œæ—¥å¿—é…ç½®
    enable_progress_bar: true
    enable_model_summary: true
    deterministic: false
    
    # æ€§èƒ½ä¼˜åŒ– - ä¸baselineä¿æŒä¸€è‡´
    log_every_n_steps: 10
    benchmark: false
    detect_anomaly: false

# === å›è°ƒå‡½æ•°é…ç½® ===
# ä¸optical_baseline.yamlä¿æŒå®Œå…¨ä¸€è‡´
callbacks:
  # æ¨¡å‹æ£€æŸ¥ç‚¹
  model_checkpoint:
    target: pytorch_lightning.callbacks.ModelCheckpoint
    params:
      filename: "best-{epoch:02d}-{val_f1:.4f}"
      monitor: "val_f1"
      mode: "max"
      save_top_k: 1
      save_last: true
      verbose: true
  
  # æ—©åœ - ä¸baselineä¸€è‡´
  early_stopping:
    target: pytorch_lightning.callbacks.EarlyStopping
    params:
      monitor: "val_f1"
      mode: "max"
      patience: 20                  # ä¸baselineä¸€è‡´
      verbose: true
      strict: false
      min_delta: 0.001
  
  # å­¦ä¹ ç‡ç›‘æ§ - ä¸baselineä¸€è‡´
  lr_monitor:
    target: pytorch_lightning.callbacks.LearningRateMonitor
    params:
      logging_interval: "epoch"
      log_momentum: false

# === æ—¥å¿—è®°å½•å™¨é…ç½® ===
# ä¸optical_baseline.yamlä¿æŒä¸€è‡´
loggers:
  # TensorBoard
  tensorboard:
    target: pytorch_lightning.loggers.TensorBoardLogger
    params:
      log_graph: false
      default_hp_metric: true
      name: ""                      # ä¸baselineä¸€è‡´
      version: ""                   # ä¸baselineä¸€è‡´

# === è¾“å‡ºç›®å½•é…ç½® ===
# ä¸optical_baseline.yamlä¿æŒä¸€è‡´
outputs:
  base_output_dir: "lightning_landslide/exp"
  checkpoint_subdir: "checkpoints"
  log_subdir: "log"
  predictions_subdir: "predictions"

# === ç¡¬ä»¶å’Œæ€§èƒ½é…ç½® ===
# ä¸optical_baseline.yamlä¿æŒä¸€è‡´
compute:
  gpu_ids: [0]
  mixed_precision: false            # ä¸baselineä¸€è‡´
  find_unused_parameters: false
  sync_batchnorm: true
  profiler: null

# === å®éªŒç‰¹å®šé…ç½® ===
# ä¸optical_baseline.yamlä¿æŒä¸€è‡´
experiment_config:
  class_balance_strategy: "focal_loss"
  evaluation_strategy:
    use_tta: true
    tta_augmentations: 4
    confidence_threshold: 0.5
  reporting:
    generate_confusion_matrix: true
    generate_roc_curve: true
    generate_precision_recall_curve: true
    save_predictions: true
    save_model_summary: true

# === è°ƒè¯•é…ç½® ===
debug:
  fast_dev_run: false
  overfit_batches: 0.0
  validate_data_on_start: true
  run_model_test: false
  profile_model: false

# === å®éªŒè®°å½• ===
experiment_log:
  expected_metrics:
    baseline_f1: 0.85               # åŸºç¡€è®­ç»ƒæœŸæœ›F1
    final_f1: 0.88                  # ä¸»åŠ¨å­¦ä¹ åæœŸæœ›F1
    val_accuracy: 0.87              # æœŸæœ›å‡†ç¡®ç‡
    training_time_hours: 4.0        # é¢„æœŸæ€»è®­ç»ƒæ—¶é—´
  baseline_comparison:
    previous_best_f1: 0.85          # baselineæœ€ä½³F1
    improvement_target: 0.03        # ç›®æ ‡æ”¹è¿›å¹…åº¦